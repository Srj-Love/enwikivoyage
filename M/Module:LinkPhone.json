["local i = {}\n \nfunction i.LinkOnePhone(txt, demo)\n    local link = txt;\n    local othertxt = \"\";\n    local catprefix = '';\n    local catMissingCountryCode = '';\n    local catFormatIssue = '';\n    local output;\n    if demo == 'true' then\n    \tcatprefix = ':';\n    end\n    -- any other text in brackets at the end is stored separately and ignored for the dialing number\n    if mw.ustring.gsub(txt, \"(.*)( %([^0-9]*%))$\", \"%2\") ~= txt then\n        othertxt = mw.ustring.gsub(txt, \"(.*)( %([^0-9]*%))$\", \"%2\");\n        txt = mw.ustring.gsub(txt, \"(.*)( %([^0-9]*%))$\", \"%1\");\n    end\n    -- Don't include \"ext NNNN\" in the link\n    link = mw.ustring.gsub(txt, \" +[Ee][Xx][Tt] +%d+$\", \"\");\n    -- Don't include \" xNNNN\" in the link\n    link = mw.ustring.gsub(link, \" +x%d+$\", \"\");\n    link = mw.ustring.gsub(link, \" \", \"\");\n    link = mw.ustring.gsub(link, \"'\", \"\");\n    if link == \"\" then\n        return \"\";\n    end\n    if mw.ustring.sub(link, 1, 1) ~= '+' then\n    \tcatMissingCountryCode = '",{"type":"[[","value":[["' .. catprefix .. 'Category:Listing with phone missing country code"]]},{"type":"<","value":["span",{"class":"phoneinfo","style":"display:none;"},["NOCC"]]},"';\n    end\n    if mw.ustring.match(link,\"^%+[%d-() ]+$\") ~= nil then\n        output = '",{"type":"<","value":["span",{"class":"plainlinks nourlexpansion"},["[tel:' .. link .. ' ' .. txt .. ']"]]},"' .. othertxt;\n    elseif mw.ustring.match(link,\"^%+[%d%u- ]+$\") ~= nil then\n        local extra = mw.ustring.match(link, \"%u[%d%u- ]+\")\n        link = mw.ustring.gsub(link, \"[A-C]\", \"2\");\n        link = mw.ustring.gsub(link, \"[D-F]\", \"3\");\n        link = mw.ustring.gsub(link, \"[G-I]\", \"4\");\n        link = mw.ustring.gsub(link, \"[J-L]\", \"5\");\n        link = mw.ustring.gsub(link, \"[M-O]\", \"6\");\n        link = mw.ustring.gsub(link, \"[P-S]\", \"7\");\n        link = mw.ustring.gsub(link, \"[T-V]\", \"8\");\n        link = mw.ustring.gsub(link, \"[W-Z]\", \"9\");\n        extra = mw.ustring.gsub(extra, \"[A-C]\", \"2\");\n        extra = mw.ustring.gsub(extra, \"[D-F]\", \"3\");\n        extra = mw.ustring.gsub(extra, \"[G-I]\", \"4\");\n        extra = mw.ustring.gsub(extra, \"[J-L]\", \"5\");\n        extra = mw.ustring.gsub(extra, \"[M-O]\", \"6\");\n        extra = mw.ustring.gsub(extra, \"[P-S]\", \"7\");\n        extra = mw.ustring.gsub(extra, \"[T-V]\", \"8\");\n        extra = mw.ustring.gsub(extra, \"[W-Z]\", \"9\");\n        output = '",{"type":"<","value":["span",{"class":"plainlinks nourlexpansion"},["[tel:' .. link .. ' ' .. txt .. ' (' .. extra .. ')' ..']"]]},"' .. othertxt;\n    else\n        output = txt .. othertxt;\n        if mw.ustring.match('+' .. link,\"^%+[%d-() ]+$\") == nil then\n            catFormatIssue = '",{"type":"[[","value":[["' .. catprefix .. 'Category:Listing with phone format issue"]]},{"type":"<","value":["span",{"class":"phoneinfo","style":"display:none;"},["FORMAT"]]},"';\n        end\n    end\n    if mw.ustring.match(link,\"%(0%)\") ~= nil then\n        catFormatIssue = '",{"type":"[[","value":[["' .. catprefix .. 'Category:Listing with phone format issue"]]},{"type":"<","value":["span",{"class":"phoneinfo","style":"display:none;"},["FORMAT"]]},"';\n    end\n    if mw.title.getCurrentTitle().namespace == 0 or demo == 'true' then\n        output = output .. catFormatIssue .. catMissingCountryCode;\n    end\n    return output;\nend\n\nfunction i.LinkPhone(frame)\n    local demo = frame.args[\"demo\"] or '';\n    local txtall = frame.args[1] or '' .. ',';\n    local txt = \"\";\n    local result = \"\";\n    local catprefix = '';\n    local cattemporary = '';\n    -- replace or \/ and with comma\n    txtall = mw.ustring.gsub(txtall, \" or %+\", \", +\");\n    txtall = mw.ustring.gsub(txtall, \" and %+\", \", +\");\n    for txt in mw.ustring.gmatch(txtall, \"([^,]+)\") do\n        result = result .. \", \" .. i.LinkOnePhone(txt, demo)\n    end\n    result = mw.ustring.sub(result, 3, mw.ustring.len(result) );\n    if mw.ustring.gsub(result, \".*(,).*\", \"%1\") ~= result and mw.ustring.gsub(result, \".*(Category:).*\", \"%1\") ~= result then\n        if demo == 'true' then\n            catprefix = ':';\n        end\n        cattemporary = '",{"type":"[[","value":[["' .. catprefix .. 'Category:Listing with multiple phones issue"]]},"';\n    end\n    return result .. cattemporary;\nend \nreturn i;"]