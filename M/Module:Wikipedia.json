["--",{"type":"[[","value":[["@author d:User:Legoktm\n\nThis template automatically adds the Wikipedia\nlink to the sidebar if it exists in Wikidata\n\n@version 0.1en.voy\nIf this template is copied to other sites, please try\nand copy all edits back to the main one on en.voy"]]},"--\n\n\nlocal p = {}\n\nfunction p.wplink(frame)\n    local pframe = frame:getParent()\n    local config = frame.args -- the arguments passed BY the template, in the wikitext of the template itself\n    local args = pframe.args -- the arguments passed TO the template, in the wikitext that transcludes the template\n    \n    -- do some exemption checking...\n    local text = mw.title.getCurrentTitle():getContent()\n    if string.find(text, \"",{"type":"{{","value":[["noexternallinks"]]},"\") then\n        return \"\" -- they dont want any wikidata stuff\n    end\n    \n    -- this part is rather hacky, but it works... I think.\n    -- note that this doesn't check links like nost or tenwiki\n    text = string.lower(text);\n    if string.find(text, \"%[%[wikipedia:\") then\n        return \"\"\n    end\n    if string.find(text, \"%[%[w:\") then\n        return \"\"\n    end\n    \n    local entity = mw.wikibase.getEntity()\n    if not entity then -- no Wikidata item\n        return \"\" -- we could add a tracking category here if we wanted...\n    end\n    local sitelinks = entity.sitelinks -- this will always be populated since it's a connected item :P\n    local langcode = mw.getContentLanguage():getCode();\n    local dbname = langcode.gsub('-', '_') .. \"wiki\"\n    local hasLink = sitelinks[dbname]\n    if not hasLink then\n        return \"\" -- no wikipedia link in that language\n    end\n    local link = hasLink.title\n    return \"",{"type":"[[","value":[["wikipedia:\" .. link .. \""]]},"\"\nend\n\nreturn p"]